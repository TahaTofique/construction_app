<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Construction">
    <title>Construction Management</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ec 100%);
            min-height: 100vh;
            padding-bottom: 80px;
            overflow-x: hidden;
        }

        .header {
            background: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .header-title h1 {
            font-size: 20px;
            font-weight: 700;
            color: #1a1a1a;
        }

        .header-title p {
            font-size: 12px;
            color: #666;
            margin-top: 2px;
        }

        .notification-bell {
            position: relative;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.2s;
        }

        .notification-bell:active {
            background: #e0e0e0;
        }

        .notification-badge {
            position: absolute;
            top: 0;
            right: 0;
            background: #ff3b30;
            color: white;
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 11px;
            font-weight: 700;
        }

        .role-toggle {
            display: flex;
            background: #f0f0f0;
            border-radius: 10px;
            padding: 3px;
        }

        .role-btn {
            flex: 1;
            padding: 8px 20px;
            border: none;
            background: transparent;
            color: #666;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .role-btn.active {
            background: white;
            color: #007aff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .summary-cards {
            display: flex;
            gap: 12px;
            padding: 15px 20px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .summary-cards::-webkit-scrollbar {
            display: none;
        }

        .summary-card {
            min-width: 140px;
            background: white;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }

        .summary-card-icon {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .summary-card-label {
            font-size: 11px;
            color: #666;
            margin-bottom: 5px;
        }

        .summary-card-value {
            font-size: 24px;
            font-weight: 700;
            color: #1a1a1a;
        }

        .tabs {
            display: flex;
            padding: 0 20px;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            background: white;
            border: none;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            color: #666;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .tab.active {
            background: #007aff;
            color: white;
        }

        .content {
            padding: 0 20px 20px;
        }

        .add-form {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }

        .add-form h3 {
            font-size: 16px;
            margin-bottom: 15px;
            color: #1a1a1a;
        }

        .form-group {
            margin-bottom: 12px;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 12px;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            font-size: 15px;
            background: white;
            -webkit-appearance: none;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #007aff;
        }

        .btn-primary {
            width: 100%;
            padding: 14px;
            background: #007aff;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn-primary:active {
            background: #0051d5;
        }

        .btn-success {
            background: #34c759;
        }

        .btn-success:active {
            background: #28a745;
        }

        .item-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .item-card {
            background: white;
            border-radius: 15px;
            padding: 16px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .item-title {
            font-size: 16px;
            font-weight: 600;
            color: #1a1a1a;
        }

        .status-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-in-progress {
            background: #cfe2ff;
            color: #084298;
        }

        .status-approved {
            background: #d1e7dd;
            color: #0f5132;
        }

        .item-details {
            display: flex;
            gap: 20px;
            margin-bottom: 10px;
        }

        .detail-item {
            flex: 1;
        }

        .detail-label {
            font-size: 11px;
            color: #666;
            margin-bottom: 3px;
        }

        .detail-value {
            font-size: 14px;
            font-weight: 600;
            color: #1a1a1a;
        }

        .item-meta {
            font-size: 11px;
            color: #999;
            margin-top: 10px;
        }

        .update-section {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .update-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }

        .btn-small {
            padding: 8px 16px;
            background: #007aff;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
        }

        .expense-amount {
            font-size: 22px;
            font-weight: 700;
            color: #34c759;
        }

        .category-badge {
            display: inline-block;
            padding: 4px 10px;
            background: #e3f2fd;
            color: #1976d2;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 600;
            margin-right: 8px;
        }

        .notification-item {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            border-left: 4px solid #007aff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .notification-item.read {
            border-left-color: #e0e0e0;
            opacity: 0.7;
        }

        .notification-message {
            font-size: 14px;
            color: #1a1a1a;
            margin-bottom: 8px;
        }

        .notification-time {
            font-size: 11px;
            color: #999;
        }

        .notification-new {
            display: inline-block;
            background: #007aff;
            color: white;
            padding: 2px 8px;
            border-radius: 8px;
            font-size: 10px;
            font-weight: 700;
            margin-left: 10px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        @media (max-width: 375px) {
            .header-title h1 {
                font-size: 18px;
            }
            .summary-card {
                min-width: 120px;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="header">
            <div class="header-top">
                <div class="header-title">
                    <h1>Construction Management</h1>
                    <p>Site Material & Expense Tracker</p>
                </div>
                <div class="notification-bell" onclick="app.showNotifications()" id="notifBell" style="display:none;">
                    <span style="font-size:20px;">üîî</span>
                    <span class="notification-badge" id="notifBadge" style="display:none;">0</span>
                </div>
            </div>
            <div class="role-toggle">
                <button class="role-btn active" onclick="app.setRole('owner', event)">Owner</button>
                <button class="role-btn" onclick="app.setRole('contractor', event)">Contractor</button>
            </div>
        </div>

        <div class="summary-cards">
            <div class="summary-card">
                <div class="summary-card-icon">üì¶</div>
                <div class="summary-card-label">Total Materials</div>
                <div class="summary-card-value" id="totalMaterials">0</div>
            </div>
            <div class="summary-card">
                <div class="summary-card-icon">üí∞</div>
                <div class="summary-card-label">Total Expenses</div>
                <div class="summary-card-value" id="totalExpenses">‚Ç®0</div>
            </div>
            <div class="summary-card">
                <div class="summary-card-icon">‚è∞</div>
                <div class="summary-card-label">Pending</div>
                <div class="summary-card-value" id="pendingCount">0</div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="app.showTab('materials', event)">Materials</button>
            <button class="tab" onclick="app.showTab('expenses', event)">Expenses</button>
        </div>

        <div class="content" id="content"></div>
    </div>

    <script>
        const app = {
            role: 'owner',
            currentTab: 'materials',
            materials: [],
            expenses: [],
            notifications: [],

            init: function() {
                this.loadData();
                this.render();
            },

            loadData: function() {
                try {
                    this.materials = JSON.parse(localStorage.getItem('materials') || '[]');
                    this.expenses = JSON.parse(localStorage.getItem('expenses') || '[]');
                    this.notifications = JSON.parse(localStorage.getItem('notifications') || '[]');
                } catch (e) {
                    console.error('Error loading data', e);
                }
            },

            saveData: function() {
                localStorage.setItem('materials', JSON.stringify(this.materials));
                localStorage.setItem('expenses', JSON.stringify(this.expenses));
                localStorage.setItem('notifications', JSON.stringify(this.notifications));
            },

            setRole: function(role, event) {
                this.role = role;
                document.querySelectorAll('.role-btn').forEach(function(btn) {
                    btn.classList.remove('active');
                });
                event.target.classList.add('active');
                document.getElementById('notifBell').style.display = role === 'owner' ? 'flex' : 'none';
                this.render();
            },

            showTab: function(tab, event) {
                this.currentTab = tab;
                document.querySelectorAll('.tab').forEach(function(t) {
                    t.classList.remove('active');
                });
                event.target.classList.add('active');
                this.render();
            },

            addMaterial: function() {
                const name = document.getElementById('materialName').value;
                const requiredQty = parseFloat(document.getElementById('materialQty').value);
                const unit = document.getElementById('materialUnit').value;

                if (!name || !requiredQty) return;

                const material = {
                    id: Date.now(),
                    name: name,
                    requiredQty: requiredQty,
                    usedQty: 0,
                    unit: unit,
                    status: 'pending',
                    addedBy: this.role,
                    addedAt: new Date().toISOString()
                };

                this.materials.push(material);

                if (this.role === 'contractor') {
                    this.notifications.push({
                        id: Date.now(),
                        message: 'New material requested: ' + name + ' (' + requiredQty + ' ' + unit + ')',
                        materialId: material.id,
                        read: false,
                        timestamp: new Date().toISOString()
                    });
                }

                this.saveData();
                document.getElementById('materialName').value = '';
                document.getElementById('materialQty').value = '';
                this.render();
            },

            updateMaterialUsage: function(id, usedQty) {
                const material = this.materials.find(function(m) {
                    return m.id === id;
                });
                if (material) {
                    material.usedQty = parseFloat(usedQty);
                    material.status = 'in-progress';
                    this.saveData();
                    this.render();
                }
            },

            approveMaterial: function(id) {
                const material = this.materials.find(function(m) {
                    return m.id === id;
                });
                if (material) {
                    material.status = 'approved';
                    this.saveData();
                    this.render();
                }
            },

            addExpense: function() {
                const description = document.getElementById('expenseDesc').value;
                const amount = parseFloat(document.getElementById('expenseAmount').value);
                const category = document.getElementById('expenseCategory').value;

                if (!description || !amount) return;

                this.expenses.push({
                    id: Date.now(),
                    description: description,
                    amount: amount,
                    category: category,
                    addedBy: this.role,
                    addedAt: new Date().toISOString()
                });

                this.saveData();
                document.getElementById('expenseDesc').value = '';
                document.getElementById('expenseAmount').value = '';
                this.render();
            },

            showNotifications: function() {
                this.currentTab = 'notifications';
                this.render();
            },

            markNotificationRead: function(id) {
                const notif = this.notifications.find(function(n) {
                    return n.id === id;
                });
                if (notif) {
                    notif.read = true;
                    this.saveData();
                    this.render();
                }
            },

            render: function() {
                this.updateSummary();
                
                if (this.currentTab === 'materials') {
                    this.renderMaterials();
                } else if (this.currentTab === 'expenses') {
                    this.renderExpenses();
                } else if (this.currentTab === 'notifications') {
                    this.renderNotifications();
                }
            },

            updateSummary: function() {
                document.getElementById('totalMaterials').textContent = this.materials.length;
                const totalExp = this.expenses.reduce(function(sum, e) {
                    return sum + e.amount;
                }, 0);
                document.getElementById('totalExpenses').textContent = '‚Ç®' + totalExp.toLocaleString();
                const pending = this.materials.filter(function(m) {
                    return m.status === 'pending';
                }).length;
                document.getElementById('pendingCount').textContent = pending;
                
                const unreadCount = this.notifications.filter(function(n) {
                    return !n.read;
                }).length;
                const badge = document.getElementById('notifBadge');
                if (unreadCount > 0) {
                    badge.textContent = unreadCount;
                    badge.style.display = 'block';
                } else {
                    badge.style.display = 'none';
                }
            },

            renderMaterials: function() {
                const self = this;
                const content = document.getElementById('content');
                let html = '<div class="add-form"><h3>Add New Material</h3><div class="form-group"><input type="text" class="form-input" id="materialName" placeholder="Material name"></div><div class="form-group"><input type="number" class="form-input" id="materialQty" placeholder="Required quantity"></div><div class="form-group"><select class="form-select" id="materialUnit"><option value="kg">kg</option><option value="ton">ton</option><option value="m¬≥">m¬≥</option><option value="pcs">pcs</option><option value="bags">bags</option></select></div><button class="btn-primary" onclick="app.addMaterial()">Add Material</button></div><div class="item-list">';

                if (this.materials.length === 0) {
                    html += '<div class="empty-state"><div class="empty-state-icon">üì¶</div><p>No materials added yet</p></div>';
                } else {
                    this.materials.forEach(function(m) {
                        const statusClass = m.status === 'approved' ? 'status-approved' : m.status === 'in-progress' ? 'status-in-progress' : 'status-pending';
                        const dateStr = new Date(m.addedAt).toLocaleDateString();
                        html += '<div class="item-card"><div class="item-header"><div class="item-title">' + m.name + '</div><div class="status-badge ' + statusClass + '">' + m.status + '</div></div><div class="item-details"><div class="detail-item"><div class="detail-label">Required</div><div class="detail-value">' + m.requiredQty + ' ' + m.unit + '</div></div><div class="detail-item"><div class="detail-label">Used</div><div class="detail-value">' + m.usedQty + ' ' + m.unit + '</div></div><div class="detail-item"><div class="detail-label">Remaining</div><div class="detail-value">' + (m.requiredQty - m.usedQty) + ' ' + m.unit + '</div></div></div><div class="item-meta">Added by ' + m.addedBy + ' on ' + dateStr + '</div>';
                        
                        if (self.role === 'contractor') {
                            html += '<div class="update-section"><input type="number" class="update-input" id="update-' + m.id + '" placeholder="Update used qty"><button class="btn-small" onclick="app.updateMaterialUsage(' + m.id + ', document.getElementById(\'update-' + m.id + '\').value)">Update</button></div>';
                        }
                        
                        if (self.role === 'owner' && m.status === 'pending') {
                            html += '<button class="btn-primary btn-success" style="margin-top:12px;" onclick="app.approveMaterial(' + m.id + ')">Approve</button>';
                        }
                        
                        html += '</div>';
                    });
                }

                html += '</div>';
                content.innerHTML = html;
            },

            renderExpenses: function() {
                const content = document.getElementById('content');
                let html = '<div class="add-form"><h3>Log New Expense</h3><div class="form-group"><input type="text" class="form-input" id="expenseDesc" placeholder="Description"></div><div class="form-group"><input type="number" class="form-input" id="expenseAmount" placeholder="Amount (‚Ç®)"></div><div class="form-group"><select class="form-select" id="expenseCategory"><option value="materials">Materials</option><option value="labor">Labor</option><option value="equipment">Equipment</option><option value="transport">Transport</option><option value="other">Other</option></select></div><button class="btn-primary btn-success" onclick="app.addExpense()">Add Expense</button></div><div class="item-list">';

                if (this.expenses.length === 0) {
                    html += '<div class="empty-state"><div class="empty-state-icon">üí∞</div><p>No expenses logged yet</p></div>';
                } else {
                    this.expenses.forEach(function(e) {
                        const dateStr = new Date(e.addedAt).toLocaleDateString();
                        html += '<div class="item-card"><div class="item-header"><div class="item-title">' + e.description + '</div><div class="expense-amount">‚Ç®' + e.amount.toLocaleString() + '</div></div><div style="margin-top:10px;"><span class="category-badge">' + e.category + '</span><span style="font-size:12px;color:#999;">Added by ' + e.addedBy + '</span><span style="font-size:12px;color:#999;margin-left:10px;">' + dateStr + '</span></div></div>';
                    });
                }

                html += '</div>';
                content.innerHTML = html;
            },

            renderNotifications: function() {
                const self = this;
                const content = document.getElementById('content');
                let html = '<div class="item-list">';

                if (this.notifications.length === 0) {
                    html += '<div class="empty-state"><div class="empty-state-icon">üîî</div><p>No notifications</p></div>';
                } else {
                    this.notifications.forEach(function(n) {
                        const dateStr = new Date(n.timestamp).toLocaleString();
                        html += '<div class="notification-item ' + (n.read ? 'read' : '') + '" onclick="app.markNotificationRead(' + n.id + ')"><div class="notification-message">' + n.message;
                        if (!n.read) {
                            html += '<span class="notification-new">NEW</span>';
                        }
                        html += '</div><div class="notification-time">' + dateStr + '</div></div>';
                    });
                }

                html += '</div>';
                content.innerHTML = html;
            }
        };

        app.init();
    </script>
</body>
</html>
